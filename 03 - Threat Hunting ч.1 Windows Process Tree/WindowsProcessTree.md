## 1. Що таке Threat Hunting?
Для того щоб наші комп'ютерні системи були у безпеці, ми - кібербезпечники, маємо постійно моніторити ці системи та реагувати на загрози. Наші активності по захисту систем можуть бути проактивними, та реактивними. Реактивність - це коли ми реагуємо на події інформаціної безпеки після того як системи автоматичного моніторингу задетектують підозрілі активності. Наприклад, на комп'ютерах нашої компанії встановлено EDR (модний антивірус), і EDR створив повідомлення про виконання підозрілої PowerShell команди на одній з ОС. Проактивність - це коли ми не чекаємо сповіщень, а аналізуємо доступну нам інформацію про систему в пошуках будь-яких аномалій. Наприклад, ми аналізумо логи операційних систем, мережевих пристроїв, наших хмарних інфраструктур, тощо, і знаходимо події яких не мало б бути.  
**Threat Hunting** - це процес проактивного пошуку загроз в комп'ютерних системах шляхом використання різних способів аналізу даних (логів).  

На цьому занятті ми почнемо з простого - ми будемо Threat Hunt-ити в процесах ОС Windows.

## 2. Процеси Windows
Для того щоб знаходити аномальні процеси потрібно знати як виглядають нормальні процеси та здорове дерево процесів. [Ми вивчали основу процесів на першому занятті вступного курсу](https://github.com/sarin00/Course1-Intro-to-Cybersecruity/blob/main/01%20%D0%9F%D0%97%20-%20%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%B8%20Windows/Windows%20Basics.md#3-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D0%B8). Почнемо з того що подивимось як виглядає дерево процесів на вашій Windwos ОС.

### Завдання 1: Procexp64
1. Завантажте [Sysinternals інструменти з сайту Майкрософт](https://learn.microsoft.com/en-us/sysinternals/downloads/).  
2. Відкрийте програму під назвою procexp64 з привілеями адміністратора. Ця програма покаже ваше дерево процесів, а також деталі про кожен окремий процес.
3. Зверніть увагу на таку інформацію: **назва процесу**, його **PID** (process ID), **PPID** (Parent PID, можна побачити в properties), **Path** (де знаходиться файл з програмним кодом, з якого виконуєтсья цей процес), та **Command Line** (команда з якою запустили цей процес).
4. Порівняйте ваше дерево процесів з малюнком вишче. Процесі помічені червоним хрестом - це проси які перестають існувати після виконання своєї короткострокової задачі існування.

## 3. Деталі про найважливіші процеси
### 3.1 System
Процес System завжди має PID 4. Всі інші процеси запущені після нього матимуть випадковий PID. Не вдаючись в деталі kernel-mode threads, цей процес запускає інші процеси які, в тому числі, відповідальні за ініціалізацію сесії ОС та сесій користувачів ОС.  

Що є **нормальним** для процесу System?  
1. PID завжди 4  
2. Path зазвичай відсутній, але в реальності файл запуску в нього C:\Windows\system32\ntoskrnl.exe  
3. Існує тільки в одному екземплярі  
4. PPID не показуєтсья, але в реальності parent process для system це System Idle Process (PID 0)

Що є **аномальним** для процесу System?  
1. Має PPID, особливо якщо parent не System Idle Process (PID 0)
2. PID не 4
3. Запушено більше ніж один екземпляр цього процесу

### 3.2 smss.exe
Smss.exe - session manager - відповідає за створення нових сесій. Перший екземпляр smss.exe запускається процесом System, і цей екземпляр залишається працювати допоки робота ОС не зупиняється повністю. Для створення конкретних сесій, ОС чи користувацьких, smss запускає тимчасові екземпляри smss.exe, по одному на сесію. Після того як сесії запущені, дочірні smss.exe перестають існувати. Сеансові (тимчасові дочірні) smss.exe запускають 2 процеси: csrss.exe, та wininit (для сесії ОС) або winlogon (для сесії користувача).  

Що є **нормальним** для smss.exe?
1. Існує тільки один живий екземпляр smss.exe
2. Path має бути %SystemRoot%\System32\smss.exe
3. Для основного smss.exe Parent process має бути System з PPID 4

Що є **аномальним** для smss.exe?
1. Для живого smss.exe Parent не System, PPID не 4 (пам'ятайте про сесійні smss.exe які запускаються основним smss.exe, що видно в логах)   
2. Запущено не з файлу %SystemRoot%\System32\smss.exe
3. Більш ніж один запущений екземпляр в моменті перевірки живого дерева процесів

### 3.3 csrss.exe
csrss.exe - client/server runtime subsystem - це процес який керує процесами, потоками, імпортом багатьох DLL які надають можливість користуватись Windows API, та контроль над завершенням GUI при завершенні роботи системи. Для кожної сесії, ОС чи користувацької, має бути по одному csrss.exe. Цей процес запускається тимчасовим, сесійним smss.exe, тому не має живого Parent Process.  

Що є **нормальним** для csrss.exe?  
1. Path %SystemRoot%\System32\csrss.exe  
2. Кількість csrss одночасно 2 чи більше  
3. Parent Process має бути non-existent
4. Має бути стільки csrss.exe, скільки сумарно winlogon + wininit процесів

Що є **аномальним** для csrss.exe?  
1. Parent Process живий, та/або не smss.exe
2. Запущено не з файлу %SystemRoot%\System32\csrss.exe
3. Нема winlogon чи wininit процесу, чий PPID співпадав би з PPID досліджуємого csrss.exe  

### 3.4 wininit.exe
Wininit (indows Initialization Process) запускає ключові процеси операційної системи - services.exe, lsass.exe, lsaiso.exe, та інші.  

Що є **нормальним** для wininit.exe?  
1. Path %SystemRoot%\System32\wininit.exe  
2. Parent Process має бути non-existent
3. Має бути тільки один процесс wininit
4. Має бути такий csrss.exe, з яким y wininit спільний PPID (їх спільким родильним процесом був завершений smss.exe)

Що є **аномальним** для wininit.exe?  
1. Запущено не з файлу %SystemRoot%\System32\wininit.exe  
2. Існує живий parent process, та/або parent process не smss.exe
3. Існує декілька wininit.exe
4. Від цього wininit не було запущено такі процеси як services.exe та lsass.exe

### 3.5 services.exe
Services.exe - Service Control Manager (SCM). Його основна відповідальність полягає в управлінні системними службами: завантаженні служб, взаємодії з ними та запуску та завершенні служб, а також управління scheduled tasks - запланованими задачами. Services.exe запускає такі важливі процеси як svchost.exe, spoolsv.exe, msmpeng.exe, та dllhost.exe.  

Що є **нормальним** для services.exe?  
1. Path %SystemRoot%\System32\services.exe
2. Parent process має бути wininit.exe
3. Існує тільки в одному екземплярі
4. Створює багато svchost.exe процесів

Що є **аномальним** для services.exe?  
1. Path не %SystemRoot%\System32\services.exe
2. Parent process не wininit.exe
3. Існує кілька екземпалярів services.exe

### 3.6 svchost.exe
Svchost.exe - host процес - запускає системні сервіси з DLL. В ОС запущено дуже багато екземплярів цього процесу. Кожен svchost.exe має параметр **-k** у своїй команді запуску.  

Що є **нормальним** для svchost.exe?  
1.  Path %SystemRoot%\System32\svchost.exe
2.  Parent process має бути services.exe
3.  Багато запущених екземплярів цього процесу
4.  Має параметр -k

Що є **аномальним** для svchost.exe?  
1. Назва не повністю співпадає з тим що має бути, e.g., svch0st.exe
2. Запущено не з %SystemRoot%\System32\svchost.exe
3. Parent Process не services.exe
4. Не має параметру -k  

### 3.7 lsass.exe
### 3.8 winlogon.exe
### 3.9 explorer.exe
