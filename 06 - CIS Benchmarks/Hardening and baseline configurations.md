## 1. Вступ
Дуже швидко в роботі секопсом ви стикнетесь з необхідністю робити мінімальні безпекові вимоги по налаштуванню операційних систем, хмарних інфраструктур, та конкретних програм. Ця дія називається Hardening, а вимоги з секʼюріті налаштувань - Baseline Configuration.

Кожна програма що має в собі безліч налаштувань, може бути вразливою виключно через неправильні налаштування її параметрів (це називається Security Misconfiguration). Наша задача - визначити список безпекових налаштувань, які мають виконуватись до того як ці програми будуть повноцінно використовуватись.  

Як і в інших темах з кібербезпеки, цю проблему за вас вже вирішили, і в нас немає необхідності вигадувати велосипед.  
Всі важливі безпекові налаштування можна знайти у CIS Benchmark під кожен необхідний вам продукт. Перейдіть на сайт з [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks) та подивіться на список продуктів для яких є рекомендовані безпекові налаштування. Для того щоб завантажити конкретний список необхідно зареєструватись на сайті, що можна зробити і з особистим імейлом.  

## 2. Які продукти мають CIS Benchmarks?
### 2.1 Хмарні інфраструктури
CIS Benchmarks існують для `AWS, Azure, GCP, Alibaba, o365, IBM, Oracle, та Snowflake.`

### 2.2 Операційні системи
Всі операційні системи з якими ви зіткнетеся у роботі мають індивідуальний список налаштувань. CIS benchmark робиться під конкретну ОС, а також під її конкретну версію. Наприклад, Windows Server 2022 та Windows Server 2019 - це 2 різних CIS Benchmarks. Багато налаштувань в них схожі бо ОС належать одній сімʼї, але тим не менш деякі вимоги відрізняються.

### 2.3 Мережеві фаєрволи
Продукти з кібербезпеки теж ефективні тільки тоді коли вони добре налаштовані. CIS Benchmarks існують для основних вендорів мережевих продуктів, таких як `Cisco, Palo Alto, F5, Fortinet, Sophos, pfSense, тощо.`

### 2.4 Серверні програми
Деякі програми є дуже важливими і критичними частинами вашої інфраструктури, і вони мають бути налаштованими як можна жорсткіше. CIS Benchmarks існують для `веб серверів (nginx, apache, IIS), баз даних (MariaDB, MongoDB, PostgreSQL, Oracle, тощо), Docker, Kubernetes, середовищ віртуалізації, та інше.` Це критичні програми, впевніться що вони правильно налаштовані якщо ваша компанія їх використовує.  

Існують CIS Benchmaks і для інших продуктів, ми сфокусувались на найважливіших. Повний список ви можете подивитись на сайті.

## 3. З чого складаються CIS Benchmarks?
Сам документ CIS Benchmark - це просто список рекомендованих налаштувань. Є 3 типи налаштувань: Level 1, Level 2, та NG.  

Level 1 - це загальні рекомендовані налаштування які не мають негативно впливати на роботу системи. Це є необхідний мінімум якого варто притримуватись.  

Level 2 - це більш "хардкорні" налаштування, які в теорії можуть негативно вплинути на роботу деяких програм. Зазвичай L2 потрібно тільки тоді коли система обробляє секретну/таємну інформацію, або якщо цього вимагає комплаєнс (наприклад, робота над державними проектами). Якщо ви маєте імплементувати саме L2, впевніться у працездатності системи в тестовому середовищі до того як примінити ці налаштування у продакшені.  

NG - Продвинуті налаштування які можливо не доступні за замовчуванням у самій системі і вимагають додаткових програм для імплементації. NG зазвичай є опціональними налаштуваннями, додатковими для L1 чи L2. З ними вам скоріш за все не доведеться стикатись.

Кожна конкретна вимога складається з опису, пояснення важливості, вплив на систему, аудит (як перевірити це налаштування), remediation (як змінити це налаштування), та default value (як виглядає це налаштування за замовчуванням). Деякі безпекові налаштування будуть правильним за замовчуванням одразу після встановлення системи, а деякі треба доналаштовувати.

![CIS1-example](https://github.com/sarin00/Security-Operations-101/blob/main/99%20-%20%D0%94%D0%BE%D0%B4%D0%B0%D1%82%D0%BA%D0%BE%D0%B2%D1%96%20%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D1%96%D0%B0%D0%BB%D0%B8/CIS1.png)  

![CIS2-example](https://github.com/sarin00/Security-Operations-101/blob/main/99%20-%20%D0%94%D0%BE%D0%B4%D0%B0%D1%82%D0%BA%D0%BE%D0%B2%D1%96%20%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D1%96%D0%B0%D0%BB%D0%B8/CIS2.png)

## 4. Як імплементувати налаштування вказані у CIS Benchmark?
При перегляді якогось CIS Benchmark ви побачите, що налаштувань там іноді сотні. Робити їх всі вручну, ще й на регулярній основі просто неможливо. Ця проблема теж вже вирішена за вас.  

Для більшості продуктів є 2 варіанти дій:  
1. Використати імедж (образ) продукту де CIS Benchmarks вже попередньо налаштовані. Іноді це коштує грошей, але це економить час та є простим доказом аудиторам про налаштування продукту.  
2. Використати скріпт, який автоматично змінюватиме налаштування продукту. Створити скрипт самостійно займе багато часу, зате дасть гнучкість у контролі налаштувань (на випадок якщо деякі налаштування треба відключати через збої у системі). Можна використовувати вже готові скріпти написані кимось, але їх потрібно вивірювати на предмет закладеного шкідливого софта, правильності виконання, та іноді оновлювати самостійно.  

Для хмарних інфраструктур існує трошки інший концепт. Зазвичай провайдери інфраструктур рекомендують клієнтам налаштовувати інфраструктури спираючись на CIS Benchmarks, та надають інструментарій всередині хмари для аудиту налаштувань та, іноді, для автоматичної зміни цих налаштувань.  

Візьмемо для прикладу AWS. В AWS існує сервіс Security Hub, в якому можна включити перевірки налаштувань інфраструктури по CIS AWS Foundations Benchmark. Security Hub використає AWS Config для виконання перевірок, і надасть статус про кожне конкретне налаштування, compliant чи failed. У вас є можливість використати Step Functions, Lambdas, чи інші інструменти для автоматичної зміни налаштувань на бажані значення (Auto Remediation).

## 5. Формальна частина Baseline Configurations
Як і всі вимоги з кібербезпеки, baseline configurations мають бути формалізовані для того щоб вони стали обовʼязковими і дійсно виконувались. Ці вимоги можуть бути частиною Posture Management, Vulnerability Management, чи Risk Management програм (Vulnerability Management розглянемо у наступному занятті).  

Програма-мінімум:  
1. Аудит налаштувань для обраних компанією продуктів має проводитись регулярно. Як часто, якими інструментами, та хто відповідальний за керування та моніторинг аудиту? В залежності від продукту, дуже часто аудит CIS Benchmarks виконується одночасно з vulnerability скануванням одним інструментом для обох задач (наприклад Nessus Tenable сканєров). 
2. Хто відповідальний за безпосередню імплементацію налаштувань? Це дуже залежить від продукту, самої компанії та її структури підрозділів. Зазвичай за імплементацію налаштування відповідальні кібербезпечники, інфраструктурні інженери, або DevOps-и. Кібербезпечники як мінімум мають бути відповідальні за формалізацію вимог та процесу, та за аудит налаштувань.
3. Керування актуальним списком налаштувань або виключень з вимог. Дуже вірогідно, що вам доведеться зробити виключення для деяких налаштувань з CIS Benchmark. Можливо налаштування не дає вашому продукту нормально працювати, або налаштування просто не актуальне для вашої конкретної ситуації (наприклад, складність паролю для локальних Windows OS користувачів може бути неактуальною якщо у вас є домен і всі люди та програми використовують доменні облікові записи для логіну). Кібербезпечники мають тримати актуальний список виключень та/або затверджених налаштувань.  

## 6. Додаткові матеріали
1. [Сайт з CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks)
2. [Список вимог для CIS AWS Foundations Benchmark](https://docs.aws.amazon.com/securityhub/latest/userguide/cis-aws-foundations-benchmark.html)
3. [Tenable audit for CIS Benchmarks](https://www.tenable.com/vulnerability-management-dashboards/cis-compliance-benchmarks-by-category-explore)
4. [CIS-CAT pro, інструмент від CIS який автоматично налаштовує та аудитує продукти](https://www.cisecurity.org/insights/blog/how-to-automate-the-process-of-implementing-secure-configurations)
