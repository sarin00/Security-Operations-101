## 1. Вступ
Всі кібербезпечники знають, що захист компанії має бути комплексним, з різними програмами, заходами, політиками та спеціалістами. Однією з найважливіших частин такого захисту є Vulnerability Management. Перше, що приходить в голову новим кібербезпечникам - це програми, які роблять Vulnerability Scans. На жаль, без якісної стратегії Vulnerability Management навіть круті сканери будуть безкорисними.  

`Vulnerability` ( з англ. Вразливість) - це недолік системи, який знижує безпеку системи і може бути використан в зловмисних цілях. Ці недоліки можуть бути дуже різними і вимагати різних дій для їх ідентифікації.  

Розповсюджені типи вразилвостей:  
1. Вразливості в операційних системах (далі ОС);
2. Вразливості в програмах, що встановлені на ОС (в тому числі EoL програми, які вже не підтримуються вендором);
3. Вразливості в коді програм, які стоврює ваша компанія;
4. Вразливості у вебзастосунках;
5. Security Misconfigurations (з англ. Помилки в налаштуваннях безпеки) в ОС, хмарних інфраструктурах, IaC для хмарних інфраструктур, базах даних, фізичних пристроях, програмах, що використовуються у вашому середовищі, тощо. 

`Well-known vulnerabilities` (з англ. Публічно відомі вразливості) - це вразливості, про які вже було повідомлено у публічному просторі і про які знає вендор продукту. Такі вразливості можуть вже мати доступний патч/fix або якийсь час залишатись без можливості виправити вразливість, поки вендор продукту не розробить патч.  
`Zero-days` (з англ. Вразливість нульового дня) - це вразливості, що були знайдені, але ще не відомі вендору продукту. Такі вразливості ще не мають патчів і можуть використовуватись зловмисниками. Інформація про zero-day вразливості іноді продається зловмисниками. 

Більша частина інструментів, які сканують елементи інфаструктури на наявність вразливостей, будуть шукати співпадіння між базами відомих вразливостей та компонентами, що існують у вашій екосистемі. Ось приклади таких баз:  
1. [База SNYK з відомими вразливостями в software packages](https://security.snyk.io/vuln);
2. [CVE база з відомими вразливостями (CVE)](https://www.cve.org/);
3. [Список налаштувань безпеки для різних продуктів. Помилки в налаштуваннях безпеки теж призводить до компрометації](https://www.cisecurity.org/cis-benchmarks).

`CVE` (Common Vulnerabilities and Exposures) - це база даних, яка включає ідентифікатори (CVE-номери) вразливостей. Кожен CVE-номер є унікальним ідентифікатором для конкретної вразливості у конкретному продукті. CVE-номери використовуються для стандартизованого виявлення і відстеження вразливостей. Кожна вразливість може мати свій CVE-номер, який дозволяє спеціалістам з безпеки швидше зрозуміти, про яку саме проблему йдеться та як з нею боротися.  

`CVSS` score — це відкритий набір стандартів, який використовується для оцінки рівня небезпеки вразливості та призначення рівня шкоди за шкалою від 0 до 10. Коли інженери знаходять певну вразливість, їм дуже важливо оцінити її вплив, критичність для безпеки системи. Що більше шкоди ця вразливість може нанести системі, то більший буде CVSS score.
CVSS є одним із декількох способів вимірювання впливу вразливостей на безпеку системи.

## 2. Інструменти та їх функціонал
Перед тим, як порівнювати вендорів, ми маємо зрозуміти, що саме нам треба сканувати та навіщо. Коли ми говоримо про автоматичне сканування на наявність вразливостей (або місконфігурацій, помилок у конфігурації сервісів/програмному забезпеченні (далі. ПЗ), тощо), ось найпоширеніші типи сканування:
1. Сканування операційних систем (в тому числі з базами даних. Сканування імеджів чи працюючих ОС, вразливості в ОС чи ПЗ, встановленому на ОС);
2. Сканування контейнерів (імеджів чи працюючих, вразливості у ПЗ);
3. Сканування налаштувань хмарних інфраструктур (пошук місконфігурацій в AWS, Azure, GCP, тощо. Наприклад, root аккаунти без 2FA); 
4. Сканування вебзастосунків на вразливості (живі та працюючі застосунки скануються автоматично. Автоматичне сканування не дуже ефективне, але і не повністю безкорисне, і не вимагає багато людино-годин. UPD: сканування вебзастосунків є найбільш ефективним з використанням Burp Suite, за умови, що сканування проводиться виключно для конкретних запитів, які було відокремлено для сканування під час мануальної перевірки функціоналу вебзастосунку.);
5. Сканування IaC (Infrustructure as Code, наприклад Terraform. Ця тема належить до Application Security та DevSecOps, що ми вивчатимемо в окремому курсі);
6. Сканування коду, написаного вашими розробниками, на наявність вразливостей (Це теж належить до Application Security, вивчатимемо детальніше в окремому курсі. SAST та SCA сканування);
7. Моніторинг новин від вендорів кастомних ОС. Наприклад, від Palo Alto Networks, які іноді автоматично не проскануєш, але вендори завжди повідомляють про вразливості та випускають патчі.  

Тепер поговримо про те, які є опції в розгортанні сканєрів вразливостей:
1. Сканер з агентами, що встановлюються на ОС/контейнери. Це старомодний тип сканування, коли на кожну ОС/контейнер встановлюється програма (агент) сканєра, регулярно перевіряє версії встановлених програм та відправляє результати на центральний сервер. Такий тип роботи підтримують більшість вендорів, як Qualys чи Tennable;  
2. Сканер, що працює без агентів (мережевий сканєр). В таких випадках сканєри регулярно підключаються до скануємих систем, використовуючи локальні облікові записи типу username та password, та сканують всю мережу, виявляють всі ресурси, які є у мережі, відкриті сервіси та порти. Це не ідеально, оскільки всі облікові записи та паролі від скануємих ресурсів знаходяться в одному місці (на центральному сервері сканера), і це є ризиком;
3. Хмарні сканери, яким надаються спеціальні привілеї у хмарі. Такі інструменти сканують як налаштування хмари, так і всі ресурси на ній. Можуть бути cloud-native, чи зовнішнім вендорои. Бонусом є те, що відсутня необхідность зберігати облікові записи у сканері, адже замість них використовуються cloud-native інструменти для підключення (наприклад, в AWS хмарний сканер може використовувати SSM для отримування доступу до EC2);
4. Web application сканери, які можуть бути або SaaS, або розміщені на вашій інфраструктурі. Такі сканери підключаються до веб застосунків, перевіряють їх UI, всі API-ендпоінти, тощо. Це сканування менш ефективне ніж, наприклад, ручне сканування з Burp Suite. Цю тему ми вивчемо краще в курсі Application Security.  

Найпопулярнішими вендорами є:
1. Tennable;
2. Qualys;
3. Rapid7; 
4. Orca (моя особиста рекомендація);
5. Cloud-native сканєри, наприклад AWS Inspector (upd: рекомендую ScoutSuite для сканування AWS клауда);
6. Burp Suite/Acunetix (сканування вебзастосунків).

## 3. Vulnerability Management як програма у компанії
Уявімо собі, що ми налаштували сканування на вразливості у нашій команії, тепер у нас є вся інформація про всі ресурси та вразливості на них. І що ми бачимо? Тисячі старих версій операційних систем та програм на них, старі версії баз даних, відкриті сервіси та порти, які навіть SSL чи TLS не використовують. Більше того, коли ми дивимось на інформацію про конкретну вразливу ОС, все, що ми бачимо, це імʼя хоста типу `FJNTRVPC`, і нам невідомо, кому належить цей сервер і хто його має патчити. Придбання інструменту та налаштування сканування систем - це тільки 10% роботи, яку ми маємо проробити, щоб вибудувати Vulnerability Management Program у будь-якій компанії.  

Щоб почати розплановувати свою програму, нам необхідно відповісти на наступні питання:
1. Хто саме займатиметься безпосереднім патчингом ресурсів?  
2. Як ми можемо дізнатись, кому саме належить конкретний вразливий ресурс?  
3. Як втсановлювати дедлайни по патчингу і впевнитись, що патчинг є обов'язковим?  
4. Як первіряти, що патчинг стався?  
5. Як автоматизувати процес повідомлення власника ресурсу, що він має пропатчитись?  
6. Як реєструвати вийнятки, коли ресурс неможливо пропатчити?  
7. Який пріорітет матимуть різні типи вразливостей на різних типах ресурсів?  
8. Як виглядає RACI матриця відповідальностей між усіма командами, задіяними у Vulnerability Management процесі?  

Коли ви матимете відповіді на ці питання, у вас буде достатньо інформації, щоб скласти всі пазли в одну велику Vulnerability Management програму. Тепер детальніше про кожен пункт та варіанти вирішення цих задач.

### 3.1 Asset management, naming conventions, and tagging
Для того щоб у нас була можливість дізнатись, хто є власником конкретного ресурсу необхідна інвенторизація, або Asset Management. В 99% випадках команда кібербезпеки не займається безпосереднім патчингом, а тільки повідомляє власників ресурсів про необхідність пропатчитись. Для цього, зазвичай, треба щоб:  
1. Всі ресурси мали однаковий стандарт назв (naming convention), наприклад за ціллю ресурса, назовю команди чи департамента що цей ресурс підтримує, тип ОС, тощо.  
2. Ресурси мають мати обов'язкові теги. Всі хмарні інфраструктури дозволяють надавати ресурсам довільні теги. Такими тегами можуть бути support_team_name, department_name, organization_name(для великих компаній коли в групу чи концерн входять багато менших компаній), is_public (true/false), application/system_name (якщо у вашій компанії багато власних програм, у них зазвичай є свої нелогічні назви)  
3. Ці вимоги мають бути обов'язковими, не тільки у політиці на папері, а і технічно. Наприклад, тегування можна насильно вимагати конфігураційними правилами в AWS/Azure/тощо, і регулярно перевіряти чи всі ресурси відповідають вимогам та мають обов'язкові теги (наприклад за допомогою AWS Config).  

Коли всі ресурси мають стандартні назви та теги, у вас буде можливість не тільки впізнати ресур та його власника, а і автоматизувати створення тікетів з вимогою пропатчитись для конкретної команди.

### 3.2 Patching responsibilities and tickets
Як вже було вказано, у 99% випадків команда кібербезпеки не займається безпосереднім патичнгом. Цим займаються Infrastructure team, DevOps інженери, Database Engineers, розробники, що самостійно підтримують свої ресурси, тощо. Важливо: не можна надавати доступ до сканерів вразливостей нікому, окрім команди кібербезпеки. В одному місці знаходиться інформація про всі непропатчені ресурси, що є дуже цінним для зловмисників. Якщо будь-хто у вашій компанії матиме доступ до цієї інформації, вірогідність того, що зловмисник до неї дістанеться, сильно підвищується. Правильно буде створювати тікети у тікетингових системах, назначити відповідальних за цей тікет конкретну команду чи людину і надавати загальну інформацію тільки про конкретну вразливість та програму, яку вони мають пропатчити. В ідеалі, тікети мають не тільки автоматично створюватись, а також автоматично назначатись до відповідної команди.  

Тікети потрібні не тільки для того, щоб повідомляти власників ресурсів про вразливості, а й для того, щоб в них була конкретна задача на виконання, статус якої можна перевіряти. В залежності від критичності вразливості та того, чи ресурс доступний з інтернету чи ні, ми також маємо вказувати дедлайн патчингу у тікеті (наприклад, 3 дні, 30 днів, 90 днів, 180 днів для Critical, High, Medium, та Low відповідно). Тікети також дають можливість відслідковувати історичну швидкість патчингу для наших KPI, показують аудиторам швидкість та статус патчингу і є приводом для ескалації проблем менеджменту, якщо якась з команд ігнорує вимоги пропатчитись. Якщо тікет закривають вручну, але вразливість все ще не пропатчилась, тікет має автоматично знов відкритись! Закривати тікети автоматично після патчингу з наступним скануванням - це ще краще, але не завжди це легко зробити.   

У відповідальності кібербезпечників, або конкретно до Vulnerability management team, входить вимірювання та утримання деякого KPI. Недостатньо просто налаштувати всі інструменти та процеси і сидіти чекати, коли всі вразливості зникнуть. Варто вимірювати кількості вразливостей, їх критичність, швидкість закриття вразливостей, кількість незакритих вразливостей, що давно, а іноді дуже давно, вийшли за визначені терміни закриття вразливості, тощо. Ця статистика допомагає кібербезпечникам оцінювати ефективність роботи своєї та інших команд, а також звертати увагу не неідеальності чи помилки у процесах/політиках та виправляти їх.   

Для того, щоб команди патчились, потрібні не тільки тікети, а й Vulnerability Management policy та RACI матриця відповідальностей, узгоджена та затверджена менеджментом компанії. Для великих компаній, де відповідальність за різні аспекти vulnerability management розподіляється між кількома різними підрозділами, дуже корисно створити та узгодити RACI матрицю. Це необхідно для того, щоб у майбутньому ніхто не переводив свої відповідальності на інших. 

### 3.3 Vulnerability management policy
Додаткова робота, яка не приносить грощей бізнесу, ніколи не робиться якісно, якщо вона не є обов'язковою. Через це кібербезпека у будь-якій компанії покладається на ряд політик обов'язкових до виконання, в тому числі, і Vulnerability Management Policy. Коли ви створюєте будь-яку політику, необхідно визначитись з наступними питаннями:  
1. Purpose. Яка ціль цієї політики і яку проблему вона вирішує. Vulnerability Management політика потрібна для того, щоб надати чіткі вимоги по виправленню (патчингу) вразливостей на ресурсах компанії, щоб уникнути кібератаки, ускладнити експлуатацію вразливостей зловмисникам та обмежити можливість їх поширення у внутрішній мережі, коли компрометація вже сталась. Також, політика має визначати ролі та відповідальності, щоб усі розуміли свої обов'язки та очікування до їх ролі у компанії;  
2. Audience. До яких департаментів та позицій стосується ця політика;  
3. Definition of terms. Не всі мають однакове розуміння концепту вразливості, патчингу, vulnerability mitigation, compensating controls, і т.д;  
4. Risk Acceptance. Документування прийнятих ризиків. Це не є обов'язковою частиною політики, але треба розуміти, що не всі ресурси завжди можна пропатчити. Іноді, це тимчасова проблема, коли вендор якогось продукту не випускає патчі деякий час. Іноді, дуже старі IT-компоненти працюють на технологіях, які вже взагалі не підтримуються, але є критичними для бізнес-процесів (особливо, якщо мова йде про заробляння грошей). Хоча ідеально буде позбавлятися таких систем, не завжди це можливо та не завжди у бізнесу є ресурси, щоб такі старі компоненти замінити. В такому випадку нам потрібен Risk Acceptance Form, де найкраще, що можна зробити, це компенсувати вразливості за допомогою сек'юріті інструментів та/або процесів та визначити власника ризику - людину, яка буде відповідальною у разі компрометації активів компанії через цей ризик;  
5. Policy, або Obligations. Це безпосередні правила та вимоги до людей, які належать до Audience і мають відповідальності у Vulnerability Management процесі. Важливою частиною цієї секції є опис Remediation Timelines. Стандартно, вразливості діляться на категорії в залежності від маштабу загрози, яку вони несуть (Critical, High, Medium, Low). Кожна з цих категорій має мати конкретні часові рамки, у які вразливість має бути мітигована;  
6. Enforcement. Які міри покарання чекають персонал, який буде ігнорувати цю політику та не виконувати свої обов'язки вказані у ній.  

Важливо розуміти, що це тільки загальні рекомендації, які зазвичай універсальні для всіх компаній. Проте, я дуже рекомендую вам не дотримуватись щаблонів політик, а створювати політики саме під вашу компанію, її потреби та норми оперування. Створити шаблонну політику, в якій нічого не зрозуміло, або яка просто не підходить вашій компанії, буде витратою часу для всіх і не принесе користі.

Для старту написання політики корисно буде почитати стандарти індустрії та універсальні очікування від Vulnerability Management програми, а також шаблони політик, які використовуються в інших компаніях:  
1. [Поверхневий шаблон](https://frsecure.com/vulnerability-management-policy-template/);  
2. [Vulnerability Management Guidance від британського National Cyber Security Centre](https://www.ncsc.gov.uk/collection/vulnerability-management/guidance);  
3. [Об'ємний гайд по вибудовуванню Vulnerability Management Program від CISA](https://www.cisa.gov/sites/default/files/publications/CRR_Resource_Guide-VM_0.pdf).  

## 4. Практичне завдання з Nessus essentials, зареєструвати навчальну групу
Практичним завданням буде розгорнути програму для сканування інфраструктури та її ресурсів на наявність вразливостей. У вас є вибір того, який саме інструмент ви для цього використаєте:  
1. [Tennable for Education](https://www.tenable.com/whitepapers/tenable-for-education-guide);
2. або  
3. [OpenVas, що йде з Kali Linux](https://www.youtube.com/watch?v=LGh2SetiKaY).
4. Встановити будь-яку віртуальну машину з настільки старим імеджем, який ви тільки зможете знайти. При встановленні цієї ОС НЕ ОНОВЛЮЙТЕ її, ви хочете, щоб на ній було багато нерпопатченого софту. Альтернативно, встановіть віртуальну машину типу Ubuntu та навстановлюйте туди купу пакетів та їх залежностей (особливо тих, що вже не підтримуються розробниками), гарантовано багато з них матимуть вразливості. 

Якщо ви захочете додатково спробувати сканування вебзастосунків на вразливості, ви можете використати наступні вразливі застосунки, щоб просканувати їх:  
1. [OWASP Juice Shop](https://owasp.org/www-project-juice-shop/);
2. [OWASP Mutillidae II](https://owasp.org/www-project-mutillidae-ii/);
3. Або вчіть PortSwigger Academy :p
