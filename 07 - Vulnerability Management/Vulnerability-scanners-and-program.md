## 1. Вступ
Всі кібербезпечники знають, що захист компанії має бути комплексним, з різними програмами, заходами, політиками, та спеціалістами. Однією з найважливіших частин такого захисту є Vulnerability Management. Перше що приходить в голову новим кібербезпечникам - це програми що роблять Vulnerability Scans. Нажаль, без якісної стратегії Vulnerability Management навіть круті сканєри будуть безкорисними.  

`Vulnerability` - вразливість, недолік системи, який знижує безпеку системи і може бути використан в зловмисних цілях. Ці недоліки можуть бути дуже різними і вимагати різних дій для їх ідентифікації.  

Розповсюджені типи вразилвостей:  
1. Вразливості в операційних системах
2. Вразливості в програмах що встановлені на ОС (в тому числі EoL програми що вже не підтримуються вендором)
3. Вразливості в коді програм, які стоврює ваша компанія
4. Вразливості у веб застосунках
5. Security Misconfigurations в ОС, хмарних інфраструктурах, IaC для хмарних інфраструктур, базах даних, фізичних пристроях, програмах що використовуються у вашому середовищі, тощо. 

`Публічно відомі вразливості` - це вразливості, про які вже було повідомлено у публічному просторі, і про які знає вендор продукту. Такі вразливості можуть вже мати доступний патч/fix, або якийсь час залишатись без можливості виправити вразливість поки вендор продукту не розробить патч.  
`Zero-days` - це вразливості, що були знайдені, але ще не відомі вендору продукту. Такі вразливості ще не мають патчів, і можуть використовуватись зловмисниками. Інформація про zero-days іноді продається зловмисниками. 

Більшість інструментів що сканують на вразливості будуть шукати співпадіння між базами з відомими вразливостями, та компонентами що існують у вашій екосистемі. Ось приклади таких баз:  
1. [База SNYK з відомими вразливостями в software packages](https://security.snyk.io/vuln)  
2. [CVE база з відомими вразливостями](https://www.cve.org/)  
3. [Список Security налаштувань для різних продуктів. Security Misconfiguration теж призводить до компрометації](https://www.cisecurity.org/cis-benchmarks)  

`CVE` (Common Vulnerabilities and Exposures) - це база даних, яка включає ідентифікатори (CVE-номери) вразливостей. Кожен CVE-номер є унікальним ідентифікатором для конкретної вразливості у конкретному продукті. CVE-номери використовуються для стандартизованого виявлення і відстеження вразливостей. Кожна вразливість може мати свій CVE-номер, який дозволяє спеціалістам по безпеці швидше зрозуміти, про яку саме проблему йдеться та як з нею боротися.  

`CVSS` score — це відкритий набір стандартів, який використовується для оцінки вразливості та призначення рівня шкоди за шкалою від 0 до 10. Коли інженери знаходять якусь вразливість, їм дуже важливо оцінити її вплив, її критичність для безпеки системи. Чим більше шкоди ця вразливість може нанести системі - тим більший буде CVSS score.
CVSS є одним із кількох способів вимірювання впливу вразливостей на безпеку системи.

## 2. Інструменти та їх функціонал
Перед тим як порівнювати вендорів, ми маємо зрозуміти що саме нам треба сканувати та навіщо. Коли ми говоримо про автоматичне сканування на вразливості (або misconfiguration, помилки в конфігурації), ось найпоширеніші типи сканування:
1. Сканування операційних систем (в тому числі з базами даних. Сканування імеджів чи працюючих ОС, вразливості в ОС чи програмах встановлених на ОС)  
2. Сканування контейнерів (імеджів чи працюючих, вразливості у програмах)  
3. Сканування налаштувань хмарних інфраструктур (пошук місконфігурацій в AWS, Azure, GCP, тощо, наприклад root аккаунти без 2FA)  
4. Сканування веб застосунків на вразливості (живі та працюючі застосунки скануються автоматично. Автоматичне сканування не дуже ефективне, але і не повністю безкорисне і не вимагає багато людино-годин)  
5. Сканування IaC (Infrustructure as Code, наприклад Terraform. Ця тема належить до Application Security та DevSecOps, що ми вивчатимемо в окремому курсі)  
6. Сканування коду написаного вашими розробниками на вразливості (Це теж належить до Application Security, вивчатимемо детальніше в окремому курсі. SAST та SCA сканування)  
7. Моніторинг новин від вендорів кастомних ОС, наприклад від Palo Alto Networks, які іноді автоматично не проскануєш, але вендори завжди повідомляють про вразливості та випускають патчі.  

Тепер поговримо про те, які є опції в деплойменті сканєрів вразливостей:
1. Сканєр з агентами, що встановлюються на ОС/контейнери. Це старомодний тип сканування, коли на кожну ОС/контейнер встановлюється програма (агент) сканєра, регулярно перевіряє версії встановлених програм, та відправляє результати на центральний сервер. Такий тип роботи підтримують більшість вендорів, як Qualys чи Tennable.  
2. Сканєр, що працює без агентів (мережевий сканєр). В таких випадках сканєри регулярно підключаються до скануємих систем, використовуючи локальні облікові записи типу username та password, а також сканують всю мережу, виявляють всі ресурси які є у мережі та відкриті сервіси та порти. Це не ідеально, адже всі облікові записи та паролі від скануємих ресурсів знаходяться в одному місці (на центральному сервері сканєра), і це є ризиком.
3. Хмарні сканєри, яким надаються спеціальні привілеї у хмарі. Такі інструменти сканують як налаштування хмари, так і всі ресурси на ній. Можуть бути cloud-native, чи зовнішнім вендорои. Бонусом є те що нема необхідності зберігати облікові записи у сканєрі, адже замість них використовуються cloud-native інстурменти для підключення (наприклад в AWS хмарний сканєр може використовувати SSM щоб отримувати доступ до EC2).
4. Web application сканєри, які можуть бути або SaaS, або розміщені на вашій інфраструктурі. Такі сканери підключаються до веб застосунків, перевіряють їх UI, всі APIs, тощо. Це сканування набагато менш ефективне ніж, наприклад, ручне сканування з Burp Suite. Цю тему ми вивчемо краще в курсі Application Security.  

Найпопулярнішими вендорами є:
1. Tennable  
2. Qualys  
3. Rapid7  
4. Orca (моя особиста рекомендація)  
5. Cloud-native сканєри, наприклад AWS Inspector  
6. Busrp Suite (сканування веб застосунків)  

## 3. Vulnerability Management як програма у компанії
Уявімо собі, що ми налаштували сканування на вразливості у нашій команії, тепер у нас є вся інформація про всі ресурси та вразливості на них. І що ми бачимо? Тисячі старих версій операційних систем та програм на них, старі версії баз даних, відкриті сервіси та порти які навіть SSL чи TLS не використовують. Більше того, коли ми дивимось на інформацію про конкретну вразливу ОС, все що ми бачимо це її ім'я типу `FJNTRVPC`, і ми без поняття кому належить цей сервер і хто його має патчити. Покупка інструменту та налаштування сканування систем це тільки 10% роботи яку ми маємо проробити щоб вибудувати VUlnerability Management Program у будь-якій компанії.  

Щоб почати розплановувати свою програму, нам треба відповісти на наступні питання:
1. Хто саме займатиметься безпосереднім патчингом ресурсів?  
2. Як ми можемо дізнатись, кому саме належить конкретний вразливий ресурс?  
3. Як втсановлювати дедлайни по патчингу і впевнитись, що патчинг є обов'язковим?  
4. Як первіряти, що патчинг стався?  
5. Як автоматизувати процес повідомлення власника ресурсу що він має пропатчитись?  
6. Як реєструвати вийнятки, коли ресурс неможливо пропатчити?  
7. Який пріорітет матимуть різні типи вразливостей на різних типах ресурсів?  
8. Як виглядає RACI матриця відповідальностей між усіма командами, задіяними у Vulnerability Management процесі?  

Коли ви матимете відповіді на ці питання, у вас буде достатньо інформації щоб скласти всі пазли в одну велику Vulnerability Management програму. Тепер конкретніше про кожен пункт та варіанти вирішення цих задач.

### 3.1 Asset management, naming conventions, and tagging
Для того щоб у нас була можливість дізнатись, хто є власником конкретного ресурсу необхідна інвенторизація, або Asset Management. В 99% випадках команда кібербезпеки не займається безпосереднім патчингом, а тільки повідомляє власників ресурсів про необхідність пропатчитись. Для цього, зазвичай, треба щоб:  
1. Всі ресурси мали однаковий стандарт назв (naming convention), наприклад за ціллю ресурса, назовю команди чи департамента що цей ресурс підтримує, тип ОС, тощо.  
2. Ресурси мають мати обов'язкові теги. Всі хмарні інфраструктури дозволяють надавати ресурсам довільні теги. Такими тегами можуть бути support_team_name, department_name, organization_name(для великих компаній коли в групу чи концерн входять багато менших компаній), is_public (true/false), application/system_name (якщо у вашій компанії багато власних програм, у них зазвичай є свої нелогічні назви)  
3. Ці вимоги мають бути обов'язковими, не тільки у політиці на папері, а і технічно. Наприклад, тегування можна насильно вимагати конфігураційними правилами в AWS/Azure/тощо, і регулярно перевіряти чи всі ресурси відповідають вимогам та мають обов'язкові теги (наприклад за допомогою AWS Config).  

Коли всі ресурси мають стандартні назви та теги, у вас буде можливість не тільки впізнати ресур та його власника, а і автоматизувати створення тікетів з вимогою пропатчитись для конкретної команди.

### 3.2 Patching responsibilities and tickets
Як вже було сказано, у 99% випадків команда кібербезпеки не займається безпосереднім патичнгом. Цим займаються Infrastructure team, DevOps інженери, Database Engineers, розробники що самостійно підтримують свої ресурси, тощо. Важливо: не можна надавати доступ до сканєрів вразливостей нікому окрім команди кібербезпеки. В одному місці знаходиться інформація про всі непропатчені ресурси, що є дуже цінним для зловмисників. Якщо будь-хто у вашій компанії матиме доступ до цієї інформації, вірогідність того що зловмисник до неї дістанеться сильно підвищується. Правильно буде створювати тікети у тікетингових системах, назначити відповідальних за цей тікет конкретну команду чи людину, і надавати загальну інформацію тільки про уонуретну вразливість та програму яку вони мають пропатчити. В ідеалі, тікети мають не тільки автоматично створюватись, а і автоматично назначатись до правильної команди.  

Тікети потрібні не тільки для того щоб повідомляти власників ресурсів про вразливості, а і для того щоб в них була конкретна задача на виконання, статус якої можна перевіряти. В залежності від severity вразливості та того чи ресурс доступний з інтернету чи ні, ми також маємо вказувати дедлайн патчингу у тікеті (наприклад, 3 дні, 30 днів, 90 днів, 180 днів для Critical, High, Medium, та Low відповідно). Тікети також дають можливість відслідковувати історично швидкість патчингу для наших KPI, показують аудиторам швидкість та статус патчингу, і є приводом для ескалації проблем менеджменту якщо якась з команд ігнорує вимоги пропатчитись. Якщо тікет закривають вручну, але вразливість все ще не пропатчилась - тікет має автоматично знов відкритись! Закривати тікети автоматично після патчингу з наступним скануванням - це ще краще, але не завжди це легко зробити.   

Для того щоб команди патчились потрібні не тільки тікети, а і Vulnerability Management policy та RACI матриця відповідальностей, ухгоджена та затверджена менеджментом компанії.  

### 3.3 Vulnerability management policy and RACI matrix

тікети та інвенторизація вразливостей
постійний патчинг ресурсів
регулярне сканування
KPI
потрібно точно знати як виглядає ваша інфра та кому належать які ресурси (тегування, стандартизація імен)
Хто відповідальний за скаунвання, повідомлення про вразливості, та патчинг. Які терміни патчингу для яких severity
exceptions
regular pathing cycles

https://www.ncsc.gov.uk/collection/vulnerability-management/guidance

https://www.cisa.gov/sites/default/files/publications/CRR_Resource_Guide-VM_0.pdf

## 4. Практика з Nessus essentials, зареєструвати навчальну групу
https://www.tenable.com/whitepapers/tenable-for-education-guide

Або використати OpenVAS
https://www.youtube.com/watch?v=w15If3Q0GxA

https://sourceforge.net/projects/owaspbwa/
або metasplotable2
або juiceshop
також стара непропатчена ОС?
